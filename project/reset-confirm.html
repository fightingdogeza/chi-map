<h2>新しいパスワードを設定</h2>
<form id="newPassForm">
  <input type="password" id="new-password" placeholder="新しいパスワード" required>
  <button type="submit">変更する</button>
</form>
<p id="status"></p>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://xztzhsvcytquzhzduura.supabase.co",
  "YOUR_SUPABASE_ANON_KEY"
);

const { data: { session } } = await supabase.auth.getSession();
if (!session) {
  const { data, error } = await supabase.auth.getSessionFromUrl({ storeSession: true });
  if (error) document.getElementById("status").textContent = "リンクの有効期限が切れています。";
}

document.getElementById("newPassForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const newPassword = document.getElementById("new-password").value;
  const { error } = await supabase.auth.updateUser({ password: newPassword });
  const msg = document.getElementById("status");

  if (error) {
    msg.textContent = "変更に失敗しました: " + error.message;
  } else {
    msg.textContent = "パスワードを変更しました。ログイン画面に戻ってください。";
  }
});
</script>
